<!DOCTYPE html>

<meta charset="utf-8">
<title>Experimenting on models with the OpenMOLE platform</title>


<link href='style.css' type="text/css" rel="stylesheet"/>
		
<script type="text/javascript" src="js/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="js/syntaxhighlighter/scripts/shBrushScala.js"></script>
<script type="text/javascript" src="js/syntaxhighlighter/scripts/shBrushCpp.js"></script>
<script type="text/javascript" src="js/syntaxhighlighter/scripts/shBrushJava.js"></script>
<link href="js/syntaxhighlighter/styles/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="js/syntaxhighlighter/styles/shThemeEclipse.css" rel="stylesheet" type="text/css" />
        
<script type="text/javascript">SyntaxHighlighter.all()</script>
        
<link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>


<!-- Your Slides -->
<!-- One section is one slide -->

      <section>
         <p>
            <div style="text-align: center; top: 120px">
				
            <img class="displayed" style="height: 200px" src="images/openmole-logo.png"/>
            <span style="font-size:0.78em">Experimenting on models with the OpenMOLE platform</span>
            <span style="font-size:0.60em">
               <br/>
               Romain Reuillon, Mathieu Leclaire, <br/>
		ERC Geodivercity
               <br/>
               {romain.reuillon,mathieu.leclaire}@openmole.org
            </span>
            <br/>
         </p>
         </div>
      </section>


    <!--  <section>

<video width="800" height="600" />  <source src="cps.webm" /> </video>
      </section>-->

      <section> 
        <img style="height: 600px" src="images/complex.png"/>
	<div style="top: 460px; font-size: 30px">A complex-system is "comprised of a great number of heterogeneous entities, among which local interactions create multiple levels of collective structure and organization."     		
      	</div>
	<!--<img style="height: 200px" src="images/doe.jpg"/><img style="height: 200px" src="images/doe.jpg"/>-->
      </section>

      <section> 
         <img style="height: 600px; margin-left: 100px" src="images/decision.png"/>
         <div class="center" style="top: 50px">Understand / take decision.</div>
       </section>
    
       <section> 
           <div style="top: 100px">
         <img style="height: 280px; float: left" src="images/toxic.png"/>
         <img style="height: 280px; float: right" src="images/cherno.png"/>
           </div>
         <div class="center" style="top: 420px">To keep a system under control.</div>
       </section>
    
       <section> 
         <div class="center" style="top: 20px">Optimal decision</div>
         <div style="left: 300px; top: 120px"><img style="height: 300px" src="images/optimal.png"/></div>
         <div style="top: 400px">
         <ul>
            <li>Inverse problem: maximizing the efficiency of a system.</li>
            <li>Compromise: minimizing ecologic footprint while maximizing efficiency.</li>
         </ul>
         </div>
       </section>

       <section> 
         <img style="height: 600px; margin-left: 200px" src="images/robust.png"/>
         <div class="center" style="top: 250px">Optimal situations often correspond to extreme / risky ones</div>
       </section>
    
       <section> 
           <img style="width: 100%; top: 30px" src="images/oneway.jpg"/>
       </section>
    
       <section> 
         <img style="height: 600px; margin-left: 200px" src="images/monkey.png"/>
       </section>


      <section> 
          <img style="height: 600px" src="images/computerFire.jpg"/>
         <div class="center" style="top: 200px">
           <p>It is very CPU consuming:</p> 
	<ul>
          <li>calibration,</li>
      	  <li>exploration,</li>
          <li>optimisation,</li>
      	  <li>sensitivity analysis...</li>
      	</ul>      
         </div>
       </section>

      <section> 

	<img style="height: 600px" src="images/parallel.jpg"/>
	<div style="top: 100px">As a matter of fact many experiments exhibit naturally parallel aspects: 
	<ul>
          <li>stochastic simulation,</li>
      	  <li>design of experiments,</li>
      	  <li>genetic algorithms,</li>
      	  <li>sensitivity analysis,</li>
      	  <li>robustness study,</li>
      	  <li>...</li>
      	</ul>      		
      	</div>
	<!--<img style="height: 200px" src="images/doe.jpg"/><img style="height: 200px" src="images/doe.jpg"/>-->
      </section>

      <section> 
	<img style="height: 600px" src="images/egi.png"/>

	<p style="top: 70px">That's why, we can take advantage of the computationnal Grid, which federates resources over the world.</p>
	<div style="bottom: 30px; left: -70px">
	<ul>
          <li>346 resource centers</li>
      	  <li>57 countries</li>
      	  <li>337 000 cores</li>
      	  <li>218 PB</li>
      	  <li>3.2 M CPU hours / day</li>
      	</ul>    
	</div>
      </section>

      <section> 
<img style="height: 100%; width: 100%" src="images/complicateddark.jpg"/> 

<div style="top: 100px">
	<p style="text-align: left">Grid computing? But it is hard to use! It requires specific knowledge. Who wants to learn creepy details about:</p>
	<ul>
          <li>job submition,</li>
      	  <li>requirement specification,</li>
      	  <li>long term authentication,</li>
      	  <li>data placement...?</li>
      	</ul>   
</div>
      </section>

      <section> 
	<div class="center" style="top: 100px">
	<p>OpenMOLE proposes a naturally parallel formalism to design model experiments.</p><br />
  <img style="height: 200px" src="images/openmole-logo.png"/>
	</div>
      </section>


      <section> 
	<div class="center" style="top: 10px">
          OpenMOLE = OpenMO(de)LE(xperiment)<br/> <br/><img style="height: 390px" src="images/roulette.jpg"/> <br/>It makes the CPU intensive part of model experiments easier to handle. 
	</div>

      </section>

      <section> 
	<div class="center" style="top: 50px">
          <img style="height: 400px" src="images/scale.jpg"/> <br/> <br /> Prototype small and scale transparently.
	</div>
      </section>

      <section> 
	<div class="center" style="top: 50px">
          <img style="height: 400px" src="images/task.png"/> <br/>Embed your model as a black box: </br>launching command, inputs, outputs.
	</div>
      </section>

      <section> 
	<div class="center" style="top: 50px">
	  <p>Design a workflow for your experiment:</p> <br />
          <img style="height: 400px" src="images/wf.png"/>
	</div>
      </section>

      <section> 
	<div class="center" style="top: 150px">
	<p>Task is a central component in OpenMOLE.</p> <br />
	<p>Tasks are:</p>
	<ul>
          <li>portable from one computer to another,</li>
      	  <li>composable with each-others in workflows.</li>
      	</ul>
	</div>    
      </section>

      <section> 
	<div class="center" style="top: 170px">
	<p>Task are linked with each-other through transitions.</p>
        <img style="height: 100px" src="images/transition.svg"/>
	<ul>
          <li>Precedence relationship</li>
      	  <li>Data transfer</li>
      	</ul>    
	</div>
      </section>

      <section> 
	<div class="center" style="top: 70px">
	<p>Using transitions is a natural way to represent independent / parallel processing.</p> <br />
        <img style="height: 300px" src="images/parallel.svg"/> 
	</div>
      </section>

      <section> 
	<div class="center" style="top: 120px">
	<p>And synchronization points.</p> <br />
        <img style="height: 300px" src="images/sync.svg"/> 
	</div>
      </section>

      <section> 
	<div class="center" style="top: 50px">
        <img style="height: 350px" src="images/arrows.gif"/> <br /> <br />
	<p>Good, but specifying 10,000 independent processes with 10,000 transitions might be a pain in the neck, isn't it???</p> <br />
	</div>
      </section>

      <section> 
	<p class="center" style="top: 150px">Of course not! <br /> <br />A special transition has been designed to allow specifying massively distributed workflows in a concise manner.</p>  
      </section>

      <section> 
	<div class="center" style="top: 40px">
	<p>The exploration transition unrolls a design of experiment.</p> <br />
        <img style="height: 400px" src="images/explo-desc.svg"/> 
	</div>
      </section>

      <section> 
	<div class="center" style="top: 40px">
	<p>It creates one execution stream by sample in the design of experiment.</p> <br />
        <img style="height: 400px" src="images/explo-exec.svg"/> 
	</div>
      </section>

      <section> 
	<p class="center" style="top: 250px">Great! But, I also need to process the results of the DoE as a whole???</p>  
      </section>

      <section> 
	<div class="center" style="top: 40px">
	<p>Don't worry! The aggregation transition is there for you, it gathers the results of a model exploration.</p> <br />
        <img style="height: 350px" src="images/agg-desc.svg"/> 
	</div>
      </section>

      <section> 
	<div class="center" style="top: 40px">
	<p>It allows to compute global indicators upon multiple parallel execution streams.</p> <br />
        <img style="height: 400px" src="images/agg-exec.svg"/> 
	</div>
      </section>

      <!--<section> 
	<p class="center" style="top: 250px">OK, but what about iterative processes???</p>  
      </section>-->

      <section> 
	<div style="top: 0px">
 	<div class="center">
	  <p>Iterative process are made possible by desining cyclic workflows.</p> <br />
          <img style="height: 300px" src="images/iterative.svg"/> 
	</div> <br />
	<p style="text-align: left">Conditions on transitions:</p>  
	<p style="text-align: right; font-size: 30px"> continuation conditions, alternative processes.</p> 
	</div>  
      </section>

      <section> 
	<div class="center" style="top: 20px">
          <p>Once the workflow has been built you may specify on which execution environment each tasks is run.</p><br />
          <img style="height: 370px" src="images/env.png"/>
	</div>
      </section>


      <section> 
	<div class="center" style="top: 50px">
          <p>Wanna try?</p><br />
          <img style="height: 380px" src="images/toy.jpg"/>
	</div>
      </section>


      <section> 
	<div class="center" style="top: 70px">
          <img style="height: 380px" src="images/dollar.jpg"/>
          <p>How much does it cost?</p><br />
	</div>
      </section>


      <section> 
	<div class="center" style="top: 70px">
          <p>It's free and open-source.</p><br />
          <img style="height: 380px" src="images/stallman.jpg"/>
	</div>
      </section>

     <section> 
	<div class="center" style="top: 30px">
          <p>The previous versions have been successfuly used by scientist in diverses application fields.</p><br />
          <img style="height: 360px" src="images/chromosome.png"/>
	</div>
      </section>


     <section> 
	<div class="center" style="top: 20px">
          <img style="height: 450px" src="images/ratp.png"/>
	</div>
      </section>

      <section> 
	<div class="center" style="top: 20px">
          <p>The 0.5 version (Boundless Bamboo) is out !</p><br />
          <img style="height: 380px" src="images/site.png"/>
	  <p>www.openmole.org</p>
	</div>
      </section>

      <section> 
	<div class="center" style="top: 70px">
          <p>Questions?</p><br />
          <img style="height: 380px" src="images/question.jpg"/>
	</div>
      </section>


<!-- Maybe a font from http://www.google.com/webfonts ? -->
<link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet'>

<style>
html { background-color: black; }
body { background-color: white; }
/* A section is a slide. It's size is 800x600, and this will never change */
section {
      /* The font from Google */
      font-family: 'Ubuntu', arial, serif;
      font-size: 40px;
}
h1, h2 {
   margin-top: 200px;
   text-align: center;
   font-size: 80px;
}
h3 {
   margin: 100px 0 50px 100px;
}

q {
   display: inline-block;
   width: 700px;
   height: 600px;
   background-color: black;
   color: white;
   font-size: 60px;
   padding: 50px;
}

/* img, video {
   width: 800px;
   height: 600px;
   position: absolute;
   top: 0;
   background-color: black;
   z-index: -1;
}*/

footer {
   position: absolute;
   bottom: 10px;
   right: 20px;
}

/* Transition effect */
/* Feel free to change the transition effect for original
   animations. See here:
   https://developer.mozilla.org/en/CSS/CSS_transitions
   How to use CSS3 Transitions: */
section {
      -moz-transition: left 400ms linear 0s;
      -webkit-transition: left 400ms linear 0s;
      -ms-transition: left 400ms linear 0s;
      transition: left 400ms linear 0s;
}

/* Before */
section { left: -150%; }
/* Now */
section[aria-selected] { left: 0; }
/* After */
section[aria-selected] ~ section { left: +150%; }

/* Incremental elements */

/* By default, visible */
.incremental > * { opacity: 1; }

/* The current item */
.incremental > *[aria-selected] { color: red; opacity: 1; }

/* The items to-be-selected */
.incremental > *[aria-selected] ~ * { opacity: 0.2; }

</style>


   <!-- Your Style -->
<!-- Define the style of your presentation -->
<!-- Style -->

<link  href="http://fonts.googleapis.com/css?family=Walter+Turncoat:regular" rel="stylesheet">
<style>
   html { background-color: black; }
   body { background-color: white; font-family: 'Ubuntu', arial, serif; }
   section > * { position: absolute; }

   section { left: -150%; }
   section[aria-selected] { left: 0; }
   section[aria-selected] ~ section { left: +150% }

   h1 {
      top: 200px;
      font-size: 70px;
      width: 100%;
      text-align: center;
   }
    
   h2 {
      top: 200px;
      font-size: 40px;
      width: 100%;
      text-align: center;
   }    
    
   ul {
      top: 100px;
      font-size: 30px;
      list-style-type: none;
      margin: 20px 50px;
   }
   
   ul li {
      margin: 10px 50px;
   }
   
   ul li span {
      display: inline-block;
      width: 80px;
      text-align: center;
      color: white;
      background-color: black;
   }

   footer { 
   	display: block;
      text-align: right;
      font-style: normal;
      font-size: 30px;
      bottom: 10px; 
      right: 20px;
   }

   a { color: #444!important; text-decoration: none; }
   a:hover {text-decoration: underline;}

   .topTitle {
      top: 20px;
      width: 100%;
      text-align: center;
   }

   IMG.displayed {
      display: block;
      margin-left: auto;
      margin-right: auto 
   }

   .fullImg {
      right: 0px;
      left: 0px;
      height: 100%;
      width: 100%;
      border: none;
   }



   .leftImg {
      right: auto;
      left: 50px;
      height: auto;
      width: 300px;
      border: none;
   }
    
   .rightImg {        
      right: 50px;
      left: auto;
      height: auto;
      width: 300px;
      border: none;
   }
    
   .centerImg {
      top: auto;
      bottom: 25%;
   }
    
    
   .center {
      top: auto;
      bottom: 50%;
      text-align: center;
   }
    
    
    
   .bottom {
      top: auto;
      bottom: 5%;
      text-align: center;
   }
   .aturtle img {
      top: 70px;
      left: 10px;
      width: 360px;
   }

   .aturtle h1 {
      width: auto;
      top: 60px;
      left: 400px;
      font-size: 50px;
   }


   .chapter {background-color: black;color: white;}

   .imgleft h1 {
      left: 400px;
      bottom: 40px;
      top: auto;
      width: auto;
      text-align: center;
      font-size: 45px;
   }
   .imgleft h1 strong {
      color: white;
      background-color: black;
      margin: 0 10px 0 10px;
      padding: 0 10px 0 10px;
      font-size: 100px;
      display: block;
      text-align: center;
      width: 350px;
   }
   /* .imgleft img:first-of-type {
      right: auto; left: 50px;
      height: auto;
      width: 300px;
      border: none;
      top: auto;
      bottom: 300px;
   }
    
   .imgleft img:nth-of-type(2) {
      right: 50px; left: auto;
      height: auto;
      width: 300px;
      border: none;
      top: auto;
      bottom: 300px;
   }*/



   #intro h1 {
      right: 20px;
      top: 70px; left: 450px;
      bottom: auto;
      font-size: 61px;
   }
   #intro h2 {
      left: 450px;
      right: 20px;
      bottom: 50px;
      color: white;
      background-color: black;
      padding: 0 10px 0 10px;
      font-size: 50px;
      text-align: center;
   }

   .aturtle strong {
      background-color: black;
      color: white;
      display: block;
      margin-top: 20px;
      padding-top: 10px;
      padding-bottom: 10px;
      text-align: center;
      font-size: 20px;
   }

   .aturtle p {
      top: 140px;
      font-size: 25px;
      left: 400px;
      right: 20px;
   }

   .video {
      background-color: black;
   }
   .video video {
      top: 0; left: 0;
      width: 800px;
      height: 600px;
   }

   #end * { left: 440px; }
   #end h1 {
      width: auto;
      top: 70px;
      left: 550px;
      font-size: 50px;
   }
   #credits h2 {
      top: 130px;
      font-size: 30px;
   }
   #credits {
      bottom: 60px;
   }
   #credits li {
      font-size: 20px;
      margin-left: 10px;
   }
   #end img {
      top: 20px;
      left: 20px;
      border: 4px solid black;
      height: 560px;
   }

/* Transition effect */
/* Feel free to change the transition effect for original
   animations. See here:
   https://developer.mozilla.org/en/CSS/CSS_transitions
   How to use CSS3 Transitions: */
section {
      -moz-transition: left 400ms linear 0s;
      -webkit-transition: left 400ms linear 0s;
      -o-transition: left 400ms linear 0s;
      -ms-transition: left 400ms linear 0s;
      transition: left 400ms linear 0s;
}

/* Before */
section { left: -150%; }
/* Now */
section[aria-selected] { left: 0; }
/* After */
section[aria-selected] ~ section { left: +150% }

</style>





<!-- {{{{ dzslides core
#
#
#     __  __  __       .  __   ___  __
#    |  \  / /__` |    | |  \ |__  /__`
#    |__/ /_ .__/ |___ | |__/ |___ .__/ core :€
#
#
# The following block of code is not supposed to be edited.
# But if you want to change the behavior of these slides,
# feel free to hack it!
#
-->

<!-- Default Style -->
<style>
* { margin: 0; padding: 0; }
details { display: none; }
body {
   width: 800px; height: 600px;
   margin-left: -400px; margin-top: -300px;
   position: absolute; top: 50%; left: 50%;
   overflow: hidden;
}
section {
   position: absolute;
   pointer-events: none;
   width: 100%; height: 100%;
}
section[aria-selected] { pointer-events: auto; }
html { overflow: hidden; }
body { display: none; }
body.loaded { display: block; }
.incremental {visibility: hidden; }
.incremental[active] {visibility: visible; }
</style>

<script>
var Dz = {
   remoteWindows: [],
   idx: -1,
   step: 0,
   slides: null,
   params: {
      autoplay: "1"
   }
};

Dz.init = function() {
   document.body.className = "loaded";
   this.slides = $$("body > section");
   this.setupParams();
   this.onhashchange();
   this.setupTouchEvents();
   this.onresize();
}
  
Dz.setupParams = function() {
   var p = window.location.search.substr(1).split('&');
   p.forEach(function(e, i, a) {
      var keyVal = e.split('=');
      Dz.params[keyVal[0]] = decodeURIComponent(keyVal[1]);
   });
}

Dz.onkeydown = function(aEvent) {
   // Don't intercept keyboard shortcuts
   if (aEvent.altKey
      || aEvent.ctrlKey
      || aEvent.metaKey
      || aEvent.shiftKey) {
      return;
   }
   if ( aEvent.keyCode == 37 // left arrow
      || aEvent.keyCode == 38 // up arrow
      || aEvent.keyCode == 33 // page up
   ) {
      aEvent.preventDefault();
      this.back();
   }
   if ( aEvent.keyCode == 39 // right arrow
      || aEvent.keyCode == 40 // down arrow
      || aEvent.keyCode == 34 // page down
   ) {
      aEvent.preventDefault();
      this.forward();
   }
   if (aEvent.keyCode == 35) { // end
      aEvent.preventDefault();
      this.goEnd();
   }
   if (aEvent.keyCode == 36) { // home
      aEvent.preventDefault();
      this.goStart();
   }
   if (aEvent.keyCode == 32) { // space
      aEvent.preventDefault();
      this.toggleContent();
   }
}

/* Touch Events */

Dz.setupTouchEvents = function() {
   var orgX, newX;
   var tracking = false;

   var db = document.body;
   db.addEventListener("touchstart", start.bind(this), false);
   db.addEventListener("touchmove", move.bind(this), false);

   function start(aEvent) {
      aEvent.preventDefault();
      tracking = true;
      orgX = aEvent.changedTouches[0].pageX;
   }

   function move(aEvent) {
      if (!tracking) return;
      newX = aEvent.changedTouches[0].pageX;
      if (orgX - newX > 100) {
      tracking = false;
      this.forward();
      } else {
      if (orgX - newX < -100) {
         tracking = false;
         this.back();
      }
      }
   }
}

/* Adapt the size of the slides to the window */

Dz.onresize = function() {
   var db = document.body;
   var sx = db.clientWidth / window.innerWidth;
   var sy = db.clientHeight / window.innerHeight;
   var transform = "scale(" + (1/Math.max(sx, sy)) + ")";

   db.style.MozTransform = transform;
   db.style.WebkitTransform = transform;
   db.style.OTransform = transform;
   db.style.msTransform = transform;
   db.style.transform = transform;
}


Dz.getDetails = function(aIdx) {
   var s = $("section:nth-of-type(" + aIdx + ")");
   var d = s.$("details");
   return d ? d.innerHTML : "";
}

Dz.onmessage = function(aEvent) {
   var argv = aEvent.data.split(" "), argc = argv.length;
   argv.forEach(function(e, i, a) { a[i] = decodeURIComponent(e) });
   var win = aEvent.source;
   if (argv[0] === "REGISTER" && argc === 1) {
      this.remoteWindows.push(win);
      this.postMsg(win, "REGISTERED", document.title, this.slides.length);
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
      return;
   }
   if (argv[0] === "BACK" && argc === 1)
      this.back();
   if (argv[0] === "FORWARD" && argc === 1)
      this.forward();
   if (argv[0] === "START" && argc === 1)
      this.goStart();
   if (argv[0] === "END" && argc === 1)
      this.goEnd();
   if (argv[0] === "TOGGLE_CONTENT" && argc === 1)
      this.toggleContent();
   if (argv[0] === "SET_CURSOR" && argc === 2)
      window.location.hash = "#" + argv[1];
   if (argv[0] === "GET_CURSOR" && argc === 1)
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
   if (argv[0] === "GET_NOTES" && argc === 1)
      this.postMsg(win, "NOTES", this.getDetails(this.idx));
}

Dz.toggleContent = function() {
   // If a Video is present in this new slide, play it.
   // If a Video is present in the previous slide, stop it.
   var s = $("section[aria-selected]");
   if (s) {
      var video = s.$("video");
      if (video) {
      if (video.ended || video.paused) {
         video.play();
      } else {
         video.pause();
      }
      }
   }
}

Dz.setCursor = function(aIdx, aStep) {
   // If the user change the slide number in the URL bar, jump
   // to this slide.
   aStep = (aStep != 0 && typeof aStep !== "undefined") ? "." + aStep : ".0";
   window.location.hash = "#" + aIdx + aStep;
}

Dz.onhashchange = function() {
   var cursor = window.location.hash.split("#"),
      newidx = 1,
      newstep = 0;
   if (cursor.length == 2) {
      newidx = ~~cursor[1].split(".")[0];
      newstep = ~~cursor[1].split(".")[1];
      if (newstep > Dz.slides[newidx - 1].$$('.incremental > *').length) {
      newstep = 0;
      newidx++;
      }
   }
   if (newidx != this.idx) {
      this.setSlide(newidx);
   }
   if (newstep != this.step) {
      this.setIncremental(newstep);
   }
   for (var i = 0; i < this.remoteWindows.length; i++) {
      this.postMsg(this.remoteWindows[i], "CURSOR", this.idx + "." + this.step);
   }
}

Dz.back = function() {
   if (this.idx == 1 && this.step == 0) {
      return;
   }
   if (this.step == 0) {
      this.setCursor(this.idx - 1,
                     this.slides[this.idx - 2].$$('.incremental > *').length);
   } else {
      this.setCursor(this.idx, this.step - 1);
   }
}

Dz.forward = function() {
   if (this.idx >= this.slides.length &&
      this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
      return;
   }
   if (this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
      this.setCursor(this.idx + 1, 0);
   } else {
      this.setCursor(this.idx, this.step + 1);
   }
}

Dz.goStart = function() {
   this.setCursor(1, 0);
}

Dz.goEnd = function() {
   var lastIdx = this.slides.length;
   var lastStep = this.slides[lastIdx - 1].$$('.incremental > *').length;
   this.setCursor(lastIdx, lastStep);
}

Dz.setSlide = function(aIdx) {
   this.idx = aIdx;
   var old = $("section[aria-selected]");
   var next = $("section:nth-of-type("+ this.idx +")");
   if (old) {
      old.removeAttribute("aria-selected");
      var video = old.$("video");
      if (video) {
      video.pause();
      }
   }
   if (next) {
      next.setAttribute("aria-selected", "true");
      var video = next.$("video");
      if (video && !!+this.params.autoplay) {
      video.play();
      }
   } else {
      // That should not happen
      this.idx = -1;
      // console.warn("Slide doesn't exist.");
   }
}

Dz.setIncremental = function(aStep) {
   this.step = aStep;
   var old = this.slides[this.idx - 1].$('.incremental > *[aria-selected]');
   if (old) {
      old.removeAttribute('aria-selected');
   }
   var incrementals = this.slides[this.idx - 1].$$('.incremental');
   if (this.step <= 0) {
      incrementals.forEach(function(aNode) {
      aNode.removeAttribute('active');
      });
      return;
   }
   var next = this.slides[this.idx - 1].$$('.incremental > *')[this.step - 1];
   if (next) {
      next.setAttribute('aria-selected', true);
      next.parentNode.setAttribute('active', true);
      var found = false;
      incrementals.forEach(function(aNode) {
      if (aNode != next.parentNode)
         if (found)
            aNode.removeAttribute('active');
         else
            aNode.setAttribute('active', true);
      else
         found = true;
      });
   } else {
      setCursor(this.idx, 0);
   }
   return next;
}
  
Dz.postMsg = function(aWin, aMsg) { // [arg0, [arg1...]]
   aMsg = [aMsg];
   for (var i = 2; i < arguments.length; i++)
      aMsg.push(encodeURIComponent(arguments[i]));
   aWin.postMessage(aMsg.join(" "), "*");
}

window.onload = Dz.init.bind(Dz);
window.onkeydown = Dz.onkeydown.bind(Dz);
window.onresize = Dz.onresize.bind(Dz);
window.onhashchange = Dz.onhashchange.bind(Dz);
window.onmessage = Dz.onmessage.bind(Dz);
</script>


<script> // Helpers
if (!Function.prototype.bind) {
   Function.prototype.bind = function (oThis) {

      // closest thing possible to the ECMAScript 5 internal IsCallable
      // function 
      if (typeof this !== "function")
      throw new TypeError(
      "Function.prototype.bind - what is trying to be fBound is not callable"
      );

      var aArgs = Array.prototype.slice.call(arguments, 1),
         fToBind = this,
         fNOP = function () {},
         fBound = function () {
            return fToBind.apply( this instanceof fNOP ? this : oThis || window,
                  aArgs.concat(Array.prototype.slice.call(arguments)));
         };

      fNOP.prototype = this.prototype;
      fBound.prototype = new fNOP();

      return fBound;
   };
}

var $ = (HTMLElement.prototype.$ = function(aQuery) {
   return this.querySelector(aQuery);
}).bind(document);

var $$ = (HTMLElement.prototype.$$ = function(aQuery) {
   return this.querySelectorAll(aQuery);
}).bind(document);

NodeList.prototype.forEach = function(fun) {
   if (typeof fun !== "function") throw new TypeError();
   for (var i = 0; i < this.length; i++) {
      fun.call(this, this[i]);
   }
}

</script>
<!-- vim: set fdm=marker: }}} -->
